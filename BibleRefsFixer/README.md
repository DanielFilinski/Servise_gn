# Bible References Fixer

Утилита для поиска и автоматического добавления пропущенных библейских ссылок в файл SS+.json.

## Описание

Скрипт анализирует JSON файл с библейскими уроками и находит блоки, где в тексте упоминаются библейские ссылки (например, "Лк. 24:39"), но отсутствует поле `links`. После этого скрипт предлагает добавить эти ссылки в правильном формате.

## Файлы

- **bible_refs_fixer.py** - основной скрипт
- **bible_books_mapping.json** - маппинг русских сокращений книг Библии на числовые идентификаторы
- **bible_refs_history.json** - история решений (создаётся автоматически)

## Использование

### Через npm скрипты (рекомендуется)

```bash
# Интерактивный режим
npm run bible:fix

# Автоматический режим (применяет сохранённые решения)
npm run bible:auto

# Просмотр истории решений
npm run bible:history
```

### Напрямую через Python

#### Интерактивный режим

Сканирует файл, находит пропущенные ссылки и запрашивает подтверждение для каждой:

```bash
python3 bible_refs_fixer.py --mode interactive --input ../ResultParse/SS/SS+.json
```

Опции при обработке каждой ссылки:
- **[y]** - Подтвердить и добавить
- **[n]** - Отклонить
- **[s]** - Пропустить все оставшиеся
- **[a]** - Применить ко всем оставшимся

#### Автоматический режим

Применяет ранее подтверждённые изменения из истории без повторной проверки:

```bash
python3 bible_refs_fixer.py --mode auto --input ../ResultParse/SS/SS+.json
```

## Дополнительные параметры

- `--books-mapping` - путь к файлу с маппингом книг (по умолчанию: bible_books_mapping.json)
- `--history` - путь к файлу истории решений (по умолчанию: bible_refs_history.json)

## Безопасность

Перед изменением файла автоматически создаётся резервная копия в папке `backups/` с временной меткой:
```
backups/SS+.json.backup_YYYYMMDD_HHMMSS
```

## Примеры найденных ссылок

Скрипт распознаёт различные форматы библейских ссылок:
- `Лк. 24:39`
- `Кол. 3:18–4:6`
- `1 Кор. 11:3`
- `Исх. 18:25`
- `Притч. 22:6`

## Статистика

После обработки выводится статистика:
- Всего блоков обработано
- Найдено пропущенных ссылок
- Подтверждено изменений
- Отклонено изменений
- Пропущено изменений
